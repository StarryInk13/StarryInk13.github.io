<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stories ‚Äî Starry Ink</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Crimson+Pro:ital,wght@0,300;0,400;1,300;1,400&display=swap" rel="stylesheet"/>
  <style>
    :root{--bg:#050810;--bg2:#080d1a;--teal:#00c9b1;--glow:#00e5cc;--text:#c8d8f0;--muted:#6a7e9e;--card:rgba(10,18,40,0.85);--border:rgba(58,123,213,0.18)}
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{background:var(--bg);color:var(--text);font-family:'Crimson Pro',Georgia,serif;font-size:1.1rem;line-height:1.7;min-height:100vh;overflow-x:hidden}
    #stars{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
    .star{position:absolute;border-radius:50%;background:white;animation:twinkle var(--d,3s) ease-in-out infinite alternate}
    @keyframes twinkle{from{opacity:var(--lo,.1);transform:scale(1)}to{opacity:var(--hi,.9);transform:scale(1.3)}}
    body::before{content:'';position:fixed;inset:0;z-index:0;background:radial-gradient(ellipse 70% 50% at 20% 30%,rgba(0,100,180,.12) 0%,transparent 70%),radial-gradient(ellipse 50% 60% at 80% 70%,rgba(0,180,140,.08) 0%,transparent 70%);pointer-events:none}
    .wrap{position:relative;z-index:1;max-width:1100px;margin:0 auto;padding:0 2rem}
    nav{position:sticky;top:0;z-index:100;background:rgba(5,8,16,.85);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);padding:1rem 0}
    nav .wrap{display:flex;align-items:center;justify-content:space-between}
    .nav-logo{font-family:'Cinzel Decorative',serif;font-size:1.3rem;color:var(--teal);text-decoration:none;letter-spacing:.05em;text-shadow:0 0 18px rgba(0,201,177,.5)}
    .nav-links{display:flex;gap:2rem;list-style:none}
    .nav-links a{color:var(--muted);text-decoration:none;font-size:.95rem;letter-spacing:.08em;text-transform:uppercase;transition:color .2s}
    .nav-links a:hover{color:var(--teal)}
    .page-header{padding:5rem 0 2rem;text-align:center}
    .page-header h1{font-family:'Cinzel Decorative',serif;font-size:clamp(2rem,5vw,3.5rem);color:#fff;text-shadow:0 0 40px rgba(0,201,177,.3);margin-bottom:.5rem}
    .page-header p{color:var(--muted);font-style:italic}
    .filters{display:flex;gap:.75rem;flex-wrap:wrap;justify-content:center;margin:2rem 0}
    .filter-btn{background:transparent;border:1px solid var(--border);color:var(--muted);padding:.4rem 1.2rem;border-radius:2px;font-family:'Crimson Pro',serif;font-size:.85rem;letter-spacing:.1em;text-transform:uppercase;cursor:pointer;transition:all .2s}
    .filter-btn:hover,.filter-btn.active{border-color:var(--teal);color:var(--teal);background:rgba(0,201,177,.06)}
    .stories-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem;padding-bottom:4rem}
    .story-card{background:var(--card);border:1px solid var(--border);border-radius:4px;padding:2rem;position:relative;overflow:hidden;transition:transform .3s,box-shadow .3s,border-color .3s;cursor:pointer;user-select:none}
    .story-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--teal),transparent);opacity:0;transition:opacity .3s}
    .story-card:hover{transform:translateY(-4px);box-shadow:0 12px 40px rgba(0,201,177,.12);border-color:rgba(0,201,177,.35)}
    .story-card:hover::before{opacity:1}
    .card-tag{font-size:.7rem;letter-spacing:.2em;text-transform:uppercase;color:var(--teal);margin-bottom:.75rem;display:block}
    .card-title{font-family:'Cinzel Decorative',serif;font-size:1.05rem;color:#fff;margin-bottom:.75rem;line-height:1.3}
    .card-excerpt{color:var(--muted);font-size:.95rem;font-style:italic;line-height:1.6}
    .card-footer{margin-top:1.5rem;display:flex;justify-content:space-between;align-items:center}
    .card-stats{display:flex;gap:1rem}
    .card-stat{font-size:.8rem;color:var(--muted)}
    .read-more{color:var(--teal);letter-spacing:.1em;text-transform:uppercase;font-size:.75rem}
    .empty-state{text-align:center;padding:5rem 2rem;color:var(--muted);font-style:italic;grid-column:1/-1}
    .empty-state span{font-size:2rem;display:block;margin-bottom:1rem;opacity:.4}
    .modal-overlay{display:none;position:fixed;inset:0;z-index:200;background:rgba(3,5,12,.92);backdrop-filter:blur(8px);overflow-y:auto;padding:2rem}
    .modal-overlay.open{display:flex;align-items:flex-start;justify-content:center}
    .modal{background:var(--bg2);border:1px solid var(--border);border-left:3px solid var(--teal);border-radius:4px;padding:3rem;max-width:720px;width:100%;margin:2rem auto;position:relative;animation:fadeUp .3s ease}
    .modal-close{position:absolute;top:1.5rem;right:1.5rem;background:none;border:none;color:var(--muted);font-size:1.5rem;cursor:pointer;transition:color .2s;z-index:10}
    .modal-close:hover{color:var(--teal)}
    .modal-tag{font-size:.7rem;letter-spacing:.2em;text-transform:uppercase;color:var(--teal);margin-bottom:1rem;display:block}
    .modal-title{font-family:'Cinzel Decorative',serif;font-size:1.8rem;color:#fff;margin-bottom:2rem;line-height:1.3}
    .modal-body{color:var(--text);font-size:1.05rem;line-height:1.9}
    .modal-body p{margin-bottom:1.2rem}
    .modal-body p:first-of-type::first-letter{font-family:'Cinzel Decorative',serif;font-size:3.5rem;float:left;line-height:.8;margin:.1em .1em 0 0;color:var(--teal);text-shadow:0 0 20px rgba(0,201,177,.4)}
    .story-actions{margin-top:2.5rem;padding-top:1.5rem;border-top:1px solid var(--border);display:flex;align-items:center;gap:1.5rem;flex-wrap:wrap}
    .like-btn{background:none;border:1px solid var(--border);color:var(--muted);padding:.5rem 1.2rem;border-radius:2px;cursor:pointer;font-family:'Crimson Pro',serif;font-size:.95rem;transition:all .2s;display:flex;align-items:center;gap:.4rem}
    .like-btn:hover{border-color:#e07070;color:#e07070;background:rgba(224,112,112,.06)}
    .like-btn.liked{border-color:#e07070;color:#e07070;background:rgba(224,112,112,.1)}
    .view-count{color:var(--muted);font-size:.85rem;font-style:italic}
    .comments-section{margin-top:2.5rem}
    .comments-title{font-family:'Cinzel Decorative',serif;font-size:.95rem;color:var(--teal);letter-spacing:.05em;margin-bottom:1.25rem}
    .comment{background:rgba(5,8,16,.6);border:1px solid var(--border);border-radius:2px;padding:1rem 1.25rem;margin-bottom:.75rem}
    .comment-name{font-size:.75rem;letter-spacing:.12em;text-transform:uppercase;color:var(--teal);margin-bottom:.3rem}
    .comment-text{color:var(--text);font-size:.95rem;font-style:italic}
    .comment-date{font-size:.72rem;color:var(--muted);margin-top:.3rem}
    .no-comments{color:var(--muted);font-style:italic;font-size:.9rem;margin-bottom:1.25rem}
    .comment-form{display:flex;flex-direction:column;gap:.75rem;margin-top:1.25rem}
    .comment-form input,.comment-form textarea{background:rgba(5,8,16,.8);border:1px solid var(--border);border-radius:2px;color:var(--text);padding:.75rem 1rem;font-family:'Crimson Pro',serif;font-size:1rem;outline:none;transition:border-color .2s;width:100%}
    .comment-form input:focus,.comment-form textarea:focus{border-color:var(--teal)}
    .comment-form textarea{min-height:80px;resize:vertical}
    .admin-overlay{display:none;position:fixed;inset:0;z-index:300;background:rgba(3,5,12,.95);backdrop-filter:blur(12px);overflow-y:auto;padding:2rem}
    .admin-overlay.open{display:flex;align-items:flex-start;justify-content:center}
    .admin-panel{background:var(--bg2);border:1px solid rgba(0,201,177,.3);border-top:3px solid var(--teal);border-radius:4px;padding:2.5rem;max-width:720px;width:100%;margin:2rem auto;position:relative;animation:fadeUp .3s ease}
    .admin-panel h2{font-family:'Cinzel Decorative',serif;color:var(--teal);font-size:1.3rem;margin-bottom:2rem;letter-spacing:.05em}
    .form-group{margin-bottom:1.25rem}
    .form-group label{display:block;font-size:.75rem;letter-spacing:.15em;text-transform:uppercase;color:var(--muted);margin-bottom:.5rem}
    .form-group input,.form-group textarea{width:100%;background:rgba(5,8,16,.8);border:1px solid var(--border);border-radius:2px;color:var(--text);padding:.75rem 1rem;font-family:'Crimson Pro',serif;font-size:1rem;transition:border-color .2s;outline:none}
    .form-group input:focus,.form-group textarea:focus{border-color:var(--teal)}
    .form-group textarea{min-height:240px;resize:vertical;line-height:1.7}
    .form-actions{display:flex;gap:1rem;flex-wrap:wrap;margin-top:1.5rem}
    .btn{display:inline-block;padding:.75rem 2rem;border-radius:2px;font-family:'Cinzel Decorative',serif;font-size:.75rem;letter-spacing:.12em;text-decoration:none;text-transform:uppercase;transition:all .3s;cursor:pointer;border:none}
    .btn-primary{background:var(--teal);color:var(--bg);box-shadow:0 0 24px rgba(0,201,177,.35)}
    .btn-primary:hover{background:var(--glow);transform:translateY(-2px)}
    .btn-outline{background:transparent;color:var(--teal);border:1px solid var(--teal)}
    .btn-outline:hover{background:rgba(0,201,177,.08);transform:translateY(-2px)}
    .btn-danger{background:transparent;color:#e05c5c;border:1px solid #e05c5c}
    .btn-danger:hover{background:rgba(224,92,92,.1)}
    .btn-sm{padding:.3rem .8rem;font-size:.65rem}
    .login-box{text-align:center}
    .login-box h2{font-family:'Cinzel Decorative',serif;color:var(--teal);font-size:1.3rem;margin-bottom:1.5rem}
    .login-error{color:#e05c5c;font-size:.85rem;margin-top:.5rem;min-height:1.2em}
    .admin-tabs{display:flex;gap:.5rem;margin-bottom:2rem;border-bottom:1px solid var(--border)}
    .admin-tab{background:none;border:none;border-bottom:2px solid transparent;color:var(--muted);padding:.5rem 1rem .75rem;font-family:'Cinzel Decorative',serif;font-size:.7rem;letter-spacing:.1em;text-transform:uppercase;cursor:pointer;transition:all .2s;margin-bottom:-1px}
    .admin-tab:hover{color:var(--text)}
    .admin-tab.active{color:var(--teal);border-bottom-color:var(--teal)}
    .tab-content{display:none}
    .tab-content.active{display:block}
    .analytics-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:1.5rem}
    .analytics-stat{text-align:center;padding:1rem;background:rgba(5,8,16,.5);border:1px solid var(--border);border-radius:2px}
    .analytics-stat .num{font-family:'Cinzel Decorative',serif;font-size:1.8rem;color:#fff;display:block}
    .analytics-stat .lbl{font-size:.7rem;letter-spacing:.15em;text-transform:uppercase;color:var(--muted)}
    .story-row{display:grid;grid-template-columns:1fr repeat(3,60px);gap:.5rem;align-items:center;padding:.6rem 0;border-bottom:1px solid rgba(58,123,213,.1);font-size:.85rem}
    .story-row.header{font-size:.7rem;letter-spacing:.1em;text-transform:uppercase;color:var(--muted)}
    .story-row span:not(:first-child){text-align:center;font-family:'Cinzel Decorative',serif;color:var(--teal)}
    .admin-story-item{display:flex;justify-content:space-between;align-items:center;padding:.75rem 0;border-bottom:1px solid rgba(58,123,213,.1);gap:1rem}
    .admin-story-item-title{color:var(--text);font-size:.95rem;flex:1}
    .admin-story-item-actions{display:flex;gap:.5rem;flex-shrink:0}
    .mod-comment{padding:.75rem 0;border-bottom:1px solid rgba(58,123,213,.1);display:flex;gap:1rem;justify-content:space-between;align-items:flex-start}
    .mod-comment-inner{flex:1}
    .mod-comment-meta{font-size:.75rem;color:var(--muted);margin-bottom:.25rem}
    .mod-comment-text{font-size:.9rem;font-style:italic;color:var(--text)}

    .toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%);background:var(--teal);color:var(--bg);padding:.75rem 2rem;border-radius:2px;font-family:'Cinzel Decorative',serif;font-size:.75rem;letter-spacing:.1em;z-index:999;opacity:0;transition:opacity .3s;pointer-events:none;white-space:nowrap}
    .toast.show{opacity:1}
    footer{position:relative;z-index:1;border-top:1px solid var(--border);padding:2rem 0;text-align:center;color:var(--muted);font-size:.85rem;margin-top:2rem}
    footer .logo-small{font-family:'Cinzel Decorative',serif;color:var(--teal);font-size:1rem;display:block;margin-bottom:.5rem}
    .footer-admin-btn{margin-top:1rem;background:rgba(10,18,40,.85);border:1px solid var(--border);color:var(--muted);cursor:pointer;font-size:.7rem;letter-spacing:.1em;text-transform:uppercase;font-family:'Cinzel Decorative',serif;padding:.5rem 1.2rem;border-radius:2px;transition:all .3s;display:inline-block}
    .footer-admin-btn:hover{border-color:var(--teal);color:var(--teal);background:rgba(0,201,177,.06)}
    @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    @media(max-width:700px){.nav-links{display:none}.modal,.admin-panel{padding:1.5rem}.analytics-grid{grid-template-columns:repeat(2,1fr)}}
  </style>
</head>
<body>
<div id="stars"></div>

<nav>
  <div class="wrap">
    <a class="nav-logo" href="index.html">‚ú¶ Starry Ink</a>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="stories.html">Stories</a></li>
    </ul>
  </div>
</nav>

<div class="page-header">
  <div class="wrap">
    <h1>The Stories</h1>
    <p>Original fiction ‚Äî all genres, all worlds, all yours to read.</p>
  </div>
</div>

<div class="wrap">
  <div class="filters" id="filters"></div>
  <div class="stories-grid" id="storiesGrid"></div>


<footer>
  <div class="wrap">
    <span class="logo-small">‚ú¶ Starry Ink</span>
    <p>¬© 2025 Starry Ink ¬∑ All stories original & copyright protected.</p>
    <br/>
    <button class="footer-admin-btn" id="adminTrigger">‚ú¶ Admin Login</button>
  </div>
</footer>

<div class="toast" id="toast"></div>

<!-- Read Story Modal -->
<div class="modal-overlay" id="storyModal">
  <div class="modal">
    <button class="modal-close" id="modalClose">‚úï</button>
    <span class="modal-tag" id="modalTag"></span>
    <div class="modal-title" id="modalTitle"></div>
    <div class="modal-body" id="modalBody"></div>
    <div class="story-actions">
      <button class="like-btn" id="likeBtn">‚ô• <span id="likeCount">0</span> Likes</button>
      <span class="view-count" id="viewCount"></span>
    </div>
    <div class="comments-section">
      <div class="comments-title">‚ú¶ Comments</div>
      <div id="commentsList"></div>
      <div class="comment-form">
        <input type="text" id="commenterName" placeholder="Your name (optional)"/>
        <textarea id="commenterText" placeholder="Leave a comment..."></textarea>
        <button class="btn btn-outline" style="align-self:flex-start" id="postCommentBtn">Post Comment</button>
      </div>
    </div>
  </div>
</div>

<!-- Admin Overlay -->
<div class="admin-overlay" id="adminOverlay">
  <div class="admin-panel" id="adminPanelBox">
    <button class="modal-close" id="adminClose">‚úï</button>

    <div id="loginScreen" class="login-box">
      <h2>‚ú¶ Admin Login</h2>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="passwordInput" placeholder="Enter password..."/>
        <div class="login-error" id="loginError"></div>
      </div>
      <button class="btn btn-primary" id="loginBtn">Enter</button>
    </div>

    <div id="adminScreen" style="display:none;">
      <h2>‚ú¶ Starry Ink Admin</h2>
      <div class="admin-tabs">
        <button class="admin-tab active" id="tab-btn-stories">Add Story</button>
        <button class="admin-tab" id="tab-btn-manage">Manage</button>
        <button class="admin-tab" id="tab-btn-analytics">Analytics</button>
        <button class="admin-tab" id="tab-btn-comments">Comments</button>
      </div>

      <div class="tab-content active" id="tab-stories">
        <div class="form-group">
          <label>Story Title *</label>
          <input type="text" id="storyTitle" placeholder="Enter title..."/>
        </div>
        <div class="form-group">
          <label>Genre / Tag</label>
          <input type="text" id="storyGenre" placeholder="e.g. Fantasy, Romance, Horror..."/>
        </div>
        <div class="form-group">
          <label>Excerpt (short teaser on card)</label>
          <input type="text" id="storyExcerpt" placeholder="A short teaser line..."/>
        </div>
        <div class="form-group">
          <label>Full Story *</label>
          <textarea id="storyBody" placeholder="Write or paste your full story here. Separate paragraphs with a blank line."></textarea>
        </div>
        <div class="form-actions">
          <button class="btn btn-primary" id="saveBtn">‚ú¶ Publish Story</button>
          <button class="btn btn-outline" id="clearBtn">Clear</button>
        </div>
      </div>

      <div class="tab-content" id="tab-manage">
        <div id="adminStoryList"></div>
      </div>

      <div class="tab-content" id="tab-analytics">
        <div class="analytics-grid" id="overviewStats"></div>
        <div class="story-row header"><span>Story</span><span>Views</span><span>Likes</span><span>Comments</span></div>
        <div id="storyAnalyticsRows"></div>
      </div>

      <div class="tab-content" id="tab-comments">
        <div id="allCommentsList"></div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  var PASS='Rose980880@';
  var SK='starryink_stories';
  var MK='starryink_meta';
  var LK='starryink_liked';

  var isAdmin=false;
  var editingId=null;
  var activeGenre='all';
  var currentStoryId=null;
  var stories=[];
  var meta={};
  var liked={};

  // Starfield
  var sc=document.getElementById('stars');
  for(var i=0;i<180;i++){
    var s=document.createElement('div');s.className='star';
    var sz=(Math.random()*2.5+.5);
    s.style.cssText='width:'+sz+'px;height:'+sz+'px;top:'+(Math.random()*100)+'%;left:'+(Math.random()*100)+'%;--lo:'+(Math.random()*.3+.05).toFixed(2)+';--hi:'+(Math.random()*.6+.3).toFixed(2)+';--d:'+(Math.random()*4+2).toFixed(1)+'s;animation-delay:'+(Math.random()*5).toFixed(1)+'s;';
    sc.appendChild(s);
  }

  function load(){
    try{stories=JSON.parse(localStorage.getItem(SK)||'[]')}catch(e){stories=[]}
    try{meta=JSON.parse(localStorage.getItem(MK)||'{}')}catch(e){meta={}}
    try{liked=JSON.parse(localStorage.getItem(LK)||'{}')}catch(e){liked={}}
  }

  function persist(){
    try{localStorage.setItem(SK,JSON.stringify(stories))}catch(e){}
    try{localStorage.setItem(MK,JSON.stringify(meta))}catch(e){}
    try{localStorage.setItem(LK,JSON.stringify(liked))}catch(e){}
  }

  function getMeta(id){
    if(!meta[id])meta[id]={views:0,likes:0,comments:[]};
    return meta[id];
  }

  function readTime(t){return Math.max(1,Math.round((t||'').split(/\s+/).length/200))}

  function showToast(msg){
    var t=document.getElementById('toast');
    t.textContent=msg;t.className='toast show';
    setTimeout(function(){t.className='toast'},2500);
  }

  // ‚îÄ‚îÄ Render story cards ‚îÄ‚îÄ
  function renderStories(){
    var grid=document.getElementById('storiesGrid');
    var filtersEl=document.getElementById('filters');
    var genres=['all'];
    stories.forEach(function(s){if(s.genre&&genres.indexOf(s.genre)===-1)genres.push(s.genre)});
    filtersEl.innerHTML=genres.map(function(g){
      return '<button class="filter-btn'+(g===activeGenre?' active':'')+'" data-genre="'+g+'">'+(g==='all'?'All':g)+'</button>';
    }).join('');
    // Attach filter events
    filtersEl.querySelectorAll('.filter-btn').forEach(function(btn){
      btn.addEventListener('click',function(e){
        e.preventDefault();e.stopPropagation();
        activeGenre=btn.getAttribute('data-genre');
        renderStories();
      });
    });
    var filtered=activeGenre==='all'?stories:stories.filter(function(s){return s.genre===activeGenre});
    if(!filtered.length){
      grid.innerHTML='<div class="empty-state"><span>‚ú¶</span>No stories yet ‚Äî check back soon.</div>';
      return;
    }
    grid.innerHTML='';
    filtered.forEach(function(s){
      var m=getMeta(s.id);
      var card=document.createElement('div');
      card.className='story-card';
      card.innerHTML='<span class="card-tag">‚ú¶ '+(s.genre||'Original Fiction')+'</span>'+
        '<div class="card-title">'+s.title+'</div>'+
        '<p class="card-excerpt">'+(s.excerpt||'')+'</p>'+
        '<div class="card-footer">'+
          '<div class="card-stats">'+
            '<span class="card-stat">üëÅ '+m.views+'</span>'+
            '<span class="card-stat">‚ô• '+m.likes+'</span>'+
            '<span class="card-stat">üí¨ '+m.comments.length+'</span>'+
          '</div>'+
          '<span class="read-more">Read ‚Üí</span>'+
        '</div>';
      card.addEventListener('click',function(e){
        e.preventDefault();e.stopPropagation();
        openStory(s.id);
      });
      grid.appendChild(card);
    });
  }

  // ‚îÄ‚îÄ Open story modal ‚îÄ‚îÄ
  function openStory(id){
    var s=null;
    for(var i=0;i<stories.length;i++){if(stories[i].id===id){s=stories[i];break}}
    if(!s)return;
    currentStoryId=id;
    var m=getMeta(id);
    m.views++;persist();
    document.getElementById('modalTag').textContent='‚ú¶ '+(s.genre||'Original Fiction');
    document.getElementById('modalTitle').textContent=s.title;
    var paras=s.body.split(/\n\n+/).filter(function(p){return p.trim()});
    document.getElementById('modalBody').innerHTML=paras.map(function(p){return'<p>'+p.replace(/\n/g,'<br>')+'</p>'}).join('');
    document.getElementById('commenterName').value='';
    document.getElementById('commenterText').value='';
    refreshLikeBtn();
    document.getElementById('viewCount').textContent=m.views+' view'+(m.views!==1?'s':'');
    renderComments();
    document.getElementById('storyModal').className='modal-overlay open';
    document.body.style.overflow='hidden';
    renderStories();
  }

  function refreshLikeBtn(){
    var m=getMeta(currentStoryId);
    var hasLiked=!!liked[currentStoryId];
    var btn=document.getElementById('likeBtn');
    btn.className='like-btn'+(hasLiked?' liked':'');
    document.getElementById('likeCount').textContent=m.likes;
  }

  function toggleLike(){
    if(!currentStoryId)return;
    var m=getMeta(currentStoryId);
    if(liked[currentStoryId]){m.likes=Math.max(0,m.likes-1);delete liked[currentStoryId]}
    else{m.likes++;liked[currentStoryId]=true}
    persist();refreshLikeBtn();renderStories();
  }

  function renderComments(){
    var m=getMeta(currentStoryId);
    var el=document.getElementById('commentsList');
    if(!m.comments.length){el.innerHTML='<div class="no-comments">No comments yet ‚Äî be the first! ‚ú¶</div>';return}
    el.innerHTML=m.comments.map(function(c){
      return'<div class="comment">'+
        '<div class="comment-name">'+(c.name||'Anonymous Reader')+'</div>'+
        '<div class="comment-text">'+c.text+'</div>'+
        '<div class="comment-date">'+new Date(c.date).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})+'</div>'+
      '</div>';
    }).join('');
  }

  function submitComment(){
    var name=document.getElementById('commenterName').value.trim();
    var text=document.getElementById('commenterText').value.trim();
    if(!text){showToast('Write something first!');return}
    getMeta(currentStoryId).comments.push({name:name,text:text,date:new Date().toISOString()});
    persist();
    document.getElementById('commenterName').value='';
    document.getElementById('commenterText').value='';
    renderComments();renderStories();
    showToast('Comment posted! ‚ú¶');
  }

  function closeModal(){
    document.getElementById('storyModal').className='modal-overlay';
    document.body.style.overflow='';
    currentStoryId=null;
  }

  // ‚îÄ‚îÄ Admin ‚îÄ‚îÄ
  function openAdmin(){
    document.getElementById('adminOverlay').className='admin-overlay open';
    document.body.style.overflow='hidden';
    if(isAdmin)showAdminScreen();
  }
  function closeAdmin(){
    document.getElementById('adminOverlay').className='admin-overlay';
    document.body.style.overflow='';
    clearForm();
  }
  function checkPassword(){
    if(document.getElementById('passwordInput').value===PASS){
      isAdmin=true;
      document.getElementById('loginError').textContent='';
      document.getElementById('passwordInput').value='';
      showAdminScreen();
    }else{
      document.getElementById('loginError').textContent='Incorrect password.';
    }
  }
  function showAdminScreen(){
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('adminScreen').style.display='block';
    renderManageList();renderAnalytics();renderAllComments();
  }

  function switchTab(tab){
    var tabs=['stories','manage','analytics','comments'];
    tabs.forEach(function(t){
      document.getElementById('tab-btn-'+t).className='admin-tab'+(t===tab?' active':'');
      document.getElementById('tab-'+t).className='tab-content'+(t===tab?' active':'');
    });
    if(tab==='manage')renderManageList();
    if(tab==='analytics')renderAnalytics();
    if(tab==='comments')renderAllComments();
  }

  function renderManageList(){
    var list=document.getElementById('adminStoryList');
    if(!stories.length){list.innerHTML='<p style="color:var(--muted);font-style:italic;font-size:.9rem;">No stories published yet.</p>';return}
    list.innerHTML='';
    stories.forEach(function(s){
      var item=document.createElement('div');item.className='admin-story-item';
      item.innerHTML='<span class="admin-story-item-title">'+s.title+'</span>'+
        '<div class="admin-story-item-actions">'+
          '<button class="btn btn-outline btn-sm" data-edit="'+s.id+'">Edit</button>'+
          '<button class="btn btn-danger btn-sm" data-delete="'+s.id+'">Delete</button>'+
        '</div>';
      item.querySelector('[data-edit]').addEventListener('click',function(){editStory(s.id)});
      item.querySelector('[data-delete]').addEventListener('click',function(){deleteStory(s.id)});
      list.appendChild(item);
    });
  }

  function renderAnalytics(){
    var totalViews=0,totalLikes=0,totalComments=0;
    stories.forEach(function(s){var m=getMeta(s.id);totalViews+=m.views;totalLikes+=m.likes;totalComments+=m.comments.length});
    document.getElementById('overviewStats').innerHTML=
      '<div class="analytics-stat"><span class="num">'+totalViews+'</span><span class="lbl">Total Views</span></div>'+
      '<div class="analytics-stat"><span class="num">'+totalLikes+'</span><span class="lbl">Total Likes</span></div>'+
      '<div class="analytics-stat"><span class="num">'+totalComments+'</span><span class="lbl">Comments</span></div>';
    if(!stories.length){document.getElementById('storyAnalyticsRows').innerHTML='<p style="color:var(--muted);font-style:italic;font-size:.9rem;margin-top:1rem;">No stories yet.</p>';return}
    var sorted=stories.slice().sort(function(a,b){return getMeta(b.id).views-getMeta(a.id).views});
    document.getElementById('storyAnalyticsRows').innerHTML=sorted.map(function(s){
      var m=getMeta(s.id);
      return'<div class="story-row"><span style="color:var(--text)">'+s.title+'</span><span>'+m.views+'</span><span>'+m.likes+'</span><span>'+m.comments.length+'</span></div>';
    }).join('');
  }

  function renderAllComments(){
    var el=document.getElementById('allCommentsList');
    var all=[];
    stories.forEach(function(s){getMeta(s.id).comments.forEach(function(c){all.push({name:c.name,text:c.text,date:c.date,storyTitle:s.title,storyId:s.id})})});
    all.sort(function(a,b){return new Date(b.date)-new Date(a.date)});
    if(!all.length){el.innerHTML='<p style="color:var(--muted);font-style:italic;font-size:.9rem;">No comments yet.</p>';return}
    el.innerHTML='';
    all.forEach(function(c){
      var div=document.createElement('div');div.className='mod-comment';
      div.innerHTML='<div class="mod-comment-inner">'+
        '<div class="mod-comment-meta">'+(c.name||'Anonymous')+' ¬∑ "'+c.storyTitle+'" ¬∑ '+new Date(c.date).toLocaleDateString()+'</div>'+
        '<div class="mod-comment-text">'+c.text+'</div>'+
      '</div>'+
      '<button class="btn btn-danger btn-sm">Delete</button>';
      div.querySelector('button').addEventListener('click',function(){deleteComment(c.storyId,c.date)});
      el.appendChild(div);
    });
  }

  function deleteComment(storyId,date){
    if(!confirm('Delete this comment?'))return;
    getMeta(storyId).comments=getMeta(storyId).comments.filter(function(c){return c.date!==date});
    persist();renderAllComments();renderAnalytics();renderStories();
    showToast('Comment deleted.');
  }

  function saveStory(){
    var title=document.getElementById('storyTitle').value.trim();
    var genre=document.getElementById('storyGenre').value.trim();
    var excerpt=document.getElementById('storyExcerpt').value.trim();
    var body=document.getElementById('storyBody').value.trim();
    if(!title||!body){showToast('Title and story are required!');return}
    if(editingId){
      for(var i=0;i<stories.length;i++){
        if(stories[i].id===editingId){stories[i].title=title;stories[i].genre=genre;stories[i].excerpt=excerpt;stories[i].body=body;break}
      }
      editingId=null;
      document.getElementById('saveBtn').textContent='‚ú¶ Publish Story';
    }else{
      stories.unshift({id:'story_'+Date.now(),title:title,genre:genre,excerpt:excerpt,body:body,date:new Date().toISOString()});
    }
    persist();clearForm();renderStories();
    showToast('Story published! ‚ú¶');
  }

  function editStory(id){
    var s=null;
    for(var i=0;i<stories.length;i++){if(stories[i].id===id){s=stories[i];break}}
    if(!s)return;
    editingId=id;
    document.getElementById('storyTitle').value=s.title;
    document.getElementById('storyGenre').value=s.genre||'';
    document.getElementById('storyExcerpt').value=s.excerpt||'';
    document.getElementById('storyBody').value=s.body;
    document.getElementById('saveBtn').textContent='‚ú¶ Update Story';
    switchTab('stories');
    document.getElementById('adminPanelBox').scrollTop=0;
  }

  function deleteStory(id){
    if(!confirm('Delete this story? This cannot be undone.'))return;
    stories=stories.filter(function(s){return s.id!==id});
    delete meta[id];
    persist();renderManageList();renderStories();
    showToast('Story deleted.');
  }

  function clearForm(){
    editingId=null;
    ['storyTitle','storyGenre','storyExcerpt','storyBody'].forEach(function(id){document.getElementById(id).value=''});
    document.getElementById('saveBtn').textContent='‚ú¶ Publish Story';
  }

  // ‚îÄ‚îÄ Wire up all events (no inline onclick) ‚îÄ‚îÄ
  document.getElementById('adminTrigger').addEventListener('click',function(e){e.preventDefault();e.stopPropagation();openAdmin()});
  document.getElementById('adminClose').addEventListener('click',function(e){e.preventDefault();closeAdmin()});
  document.getElementById('adminOverlay').addEventListener('click',function(e){if(e.target.id==='adminOverlay')closeAdmin()});
  document.getElementById('loginBtn').addEventListener('click',function(e){e.preventDefault();checkPassword()});
  document.getElementById('passwordInput').addEventListener('keydown',function(e){if(e.key==='Enter')checkPassword()});
  document.getElementById('saveBtn').addEventListener('click',function(e){e.preventDefault();saveStory()});
  document.getElementById('clearBtn').addEventListener('click',function(e){e.preventDefault();clearForm()});
  document.getElementById('modalClose').addEventListener('click',function(e){e.preventDefault();closeModal()});
  document.getElementById('storyModal').addEventListener('click',function(e){if(e.target.id==='storyModal')closeModal()});
  document.getElementById('likeBtn').addEventListener('click',function(e){e.preventDefault();e.stopPropagation();toggleLike()});
  document.getElementById('postCommentBtn').addEventListener('click',function(e){e.preventDefault();submitComment()});
  document.getElementById('tab-btn-stories').addEventListener('click',function(e){e.preventDefault();switchTab('stories')});
  document.getElementById('tab-btn-manage').addEventListener('click',function(e){e.preventDefault();switchTab('manage')});
  document.getElementById('tab-btn-analytics').addEventListener('click',function(e){e.preventDefault();switchTab('analytics')});
  document.getElementById('tab-btn-comments').addEventListener('click',function(e){e.preventDefault();switchTab('comments')});

  load();
  renderStories();
})();
</script>
</body>
</html>
