<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stories ‚Äî Starry Ink</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Crimson+Pro:ital,wght@0,300;0,400;1,300;1,400&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg:#050810;--bg2:#080d1a;--teal:#00c9b1;--blue:#3a7bd5;
      --glow:#00e5cc;--text:#c8d8f0;--muted:#6a7e9e;
      --card:rgba(10,18,40,0.85);--border:rgba(58,123,213,0.18);
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{background:var(--bg);color:var(--text);font-family:'Crimson Pro',Georgia,serif;font-size:1.1rem;line-height:1.7;min-height:100vh;overflow-x:hidden}
    #stars{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
    .star{position:absolute;border-radius:50%;background:white;animation:twinkle var(--d,3s) ease-in-out infinite alternate}
    @keyframes twinkle{from{opacity:var(--lo,.1);transform:scale(1)}to{opacity:var(--hi,.9);transform:scale(1.3)}}
    body::before{content:'';position:fixed;inset:0;z-index:0;background:radial-gradient(ellipse 70% 50% at 20% 30%,rgba(0,100,180,.12) 0%,transparent 70%),radial-gradient(ellipse 50% 60% at 80% 70%,rgba(0,180,140,.08) 0%,transparent 70%);pointer-events:none}
    .wrap{position:relative;z-index:1;max-width:1100px;margin:0 auto;padding:0 2rem}
    nav{position:sticky;top:0;z-index:100;background:rgba(5,8,16,.85);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);padding:1rem 0}
    nav .wrap{display:flex;align-items:center;justify-content:space-between}
    .nav-logo{font-family:'Cinzel Decorative',serif;font-size:1.3rem;color:var(--teal);text-decoration:none;letter-spacing:.05em;text-shadow:0 0 18px rgba(0,201,177,.5)}
    .nav-links{display:flex;gap:2rem;list-style:none}
    .nav-links a{color:var(--muted);text-decoration:none;font-size:.95rem;letter-spacing:.08em;text-transform:uppercase;transition:color .2s}
    .nav-links a:hover{color:var(--teal)}
    .page-header{padding:5rem 0 2rem;text-align:center}
    .page-header h1{font-family:'Cinzel Decorative',serif;font-size:clamp(2rem,5vw,3.5rem);color:#fff;text-shadow:0 0 40px rgba(0,201,177,.3);margin-bottom:.5rem}
    .page-header p{color:var(--muted);font-style:italic}
    .filters{display:flex;gap:.75rem;flex-wrap:wrap;justify-content:center;margin:2rem 0}
    .filter-btn{background:transparent;border:1px solid var(--border);color:var(--muted);padding:.4rem 1.2rem;border-radius:2px;font-family:'Crimson Pro',serif;font-size:.85rem;letter-spacing:.1em;text-transform:uppercase;cursor:pointer;transition:all .2s}
    .filter-btn:hover,.filter-btn.active{border-color:var(--teal);color:var(--teal);background:rgba(0,201,177,.06)}
    .stories-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem;padding-bottom:4rem}
    .story-card{background:var(--card);border:1px solid var(--border);border-radius:4px;padding:2rem;position:relative;overflow:hidden;transition:transform .3s,box-shadow .3s,border-color .3s;cursor:pointer}
    .story-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--teal),transparent);opacity:0;transition:opacity .3s}
    .story-card:hover{transform:translateY(-4px);box-shadow:0 12px 40px rgba(0,201,177,.12);border-color:rgba(0,201,177,.35)}
    .story-card:hover::before{opacity:1}
    .card-tag{font-size:.7rem;letter-spacing:.2em;text-transform:uppercase;color:var(--teal);margin-bottom:.75rem;display:block}
    .card-title{font-family:'Cinzel Decorative',serif;font-size:1.05rem;color:#fff;margin-bottom:.75rem;line-height:1.3}
    .card-excerpt{color:var(--muted);font-size:.95rem;font-style:italic;line-height:1.6}
    .card-footer{margin-top:1.5rem;display:flex;justify-content:space-between;align-items:center;font-size:.8rem;color:var(--muted)}
    .card-stats{display:flex;gap:1rem;align-items:center}
    .card-stat{display:flex;align-items:center;gap:.3rem;font-size:.8rem;color:var(--muted)}
    .read-more{color:var(--teal);letter-spacing:.1em;text-transform:uppercase;font-size:.75rem}
    .empty-state{text-align:center;padding:5rem 2rem;color:var(--muted);font-style:italic;grid-column:1/-1}
    .empty-state span{font-size:2rem;display:block;margin-bottom:1rem;opacity:.4}

    /* Story Modal */
    .modal-overlay{display:none;position:fixed;inset:0;z-index:200;background:rgba(3,5,12,.92);backdrop-filter:blur(8px);overflow-y:auto;padding:2rem}
    .modal-overlay.open{display:flex;align-items:flex-start;justify-content:center}
    .modal{background:var(--bg2);border:1px solid var(--border);border-left:3px solid var(--teal);border-radius:4px;padding:3rem;max-width:720px;width:100%;margin:2rem auto;position:relative;animation:fadeUp .3s ease}
    .modal-close{position:absolute;top:1.5rem;right:1.5rem;background:none;border:none;color:var(--muted);font-size:1.5rem;cursor:pointer;transition:color .2s}
    .modal-close:hover{color:var(--teal)}
    .modal-tag{font-size:.7rem;letter-spacing:.2em;text-transform:uppercase;color:var(--teal);margin-bottom:1rem;display:block}
    .modal-title{font-family:'Cinzel Decorative',serif;font-size:1.8rem;color:#fff;margin-bottom:2rem;line-height:1.3}
    .modal-body{color:var(--text);font-size:1.05rem;line-height:1.9}
    .modal-body p{margin-bottom:1.2rem}
    .modal-body p:first-of-type::first-letter{font-family:'Cinzel Decorative',serif;font-size:3.5rem;float:left;line-height:.8;margin:.1em .1em 0 0;color:var(--teal);text-shadow:0 0 20px rgba(0,201,177,.4)}

    /* Like & Comment area */
    .story-actions{margin-top:2.5rem;padding-top:1.5rem;border-top:1px solid var(--border);display:flex;align-items:center;gap:1.5rem}
    .like-btn{background:none;border:1px solid var(--border);color:var(--muted);padding:.5rem 1.2rem;border-radius:2px;cursor:pointer;font-family:'Crimson Pro',serif;font-size:.95rem;transition:all .2s;display:flex;align-items:center;gap:.5rem}
    .like-btn:hover,.like-btn.liked{border-color:#e07070;color:#e07070;background:rgba(224,112,112,.08)}
    .like-btn.liked{background:rgba(224,112,112,.12)}
    .view-count{color:var(--muted);font-size:.85rem;font-style:italic}

    /* Comments */
    .comments-section{margin-top:2rem}
    .comments-title{font-family:'Cinzel Decorative',serif;font-size:.9rem;color:var(--teal);letter-spacing:.05em;margin-bottom:1.25rem}
    .comment{background:rgba(5,8,16,.6);border:1px solid var(--border);border-radius:2px;padding:1rem 1.25rem;margin-bottom:.75rem}
    .comment-name{font-size:.75rem;letter-spacing:.12em;text-transform:uppercase;color:var(--teal);margin-bottom:.3rem}
    .comment-text{color:var(--text);font-size:.95rem;font-style:italic}
    .comment-date{font-size:.75rem;color:var(--muted);margin-top:.3rem}
    .comment-form{margin-top:1.25rem;display:flex;flex-direction:column;gap:.75rem}
    .comment-form input,.comment-form textarea{background:rgba(5,8,16,.8);border:1px solid var(--border);border-radius:2px;color:var(--text);padding:.75rem 1rem;font-family:'Crimson Pro',serif;font-size:1rem;outline:none;transition:border-color .2s;width:100%}
    .comment-form input:focus,.comment-form textarea:focus{border-color:var(--teal)}
    .comment-form textarea{min-height:80px;resize:vertical}
    .no-comments{color:var(--muted);font-style:italic;font-size:.9rem}

    /* Admin */
    .admin-trigger{background:rgba(10,18,40,0.85);border:1px solid var(--border);color:var(--muted);cursor:pointer;font-size:.7rem;letter-spacing:.1em;text-transform:uppercase;font-family:'Cinzel Decorative',serif;padding:.5rem 1rem;border-radius:2px;transition:all .3s;position:fixed;bottom:1.5rem;right:1.5rem;z-index:50}
    .admin-trigger:hover{border-color:var(--teal);color:var(--teal);background:rgba(0,201,177,.06)}
    .admin-overlay{display:none;position:fixed;inset:0;z-index:300;background:rgba(3,5,12,.95);backdrop-filter:blur(12px);overflow-y:auto;padding:2rem}
    .admin-overlay.open{display:flex;align-items:flex-start;justify-content:center}
    .admin-panel{background:var(--bg2);border:1px solid rgba(0,201,177,.3);border-top:3px solid var(--teal);border-radius:4px;padding:2.5rem;max-width:720px;width:100%;margin:2rem auto;position:relative;animation:fadeUp .3s ease}
    .admin-panel h2{font-family:'Cinzel Decorative',serif;color:var(--teal);font-size:1.3rem;margin-bottom:2rem;letter-spacing:.05em}
    .form-group{margin-bottom:1.25rem}
    .form-group label{display:block;font-size:.75rem;letter-spacing:.15em;text-transform:uppercase;color:var(--muted);margin-bottom:.5rem}
    .form-group input,.form-group textarea{width:100%;background:rgba(5,8,16,.8);border:1px solid var(--border);border-radius:2px;color:var(--text);padding:.75rem 1rem;font-family:'Crimson Pro',serif;font-size:1rem;transition:border-color .2s;outline:none}
    .form-group input:focus,.form-group textarea:focus{border-color:var(--teal)}
    .form-group textarea{min-height:240px;resize:vertical;line-height:1.7}
    .form-actions{display:flex;gap:1rem;flex-wrap:wrap;margin-top:1.5rem}
    .btn{display:inline-block;padding:.75rem 2rem;border-radius:2px;font-family:'Cinzel Decorative',serif;font-size:.75rem;letter-spacing:.12em;text-decoration:none;text-transform:uppercase;transition:all .3s;cursor:pointer;border:none}
    .btn-primary{background:var(--teal);color:var(--bg);box-shadow:0 0 24px rgba(0,201,177,.35)}
    .btn-primary:hover{background:var(--glow);box-shadow:0 0 40px rgba(0,229,204,.5);transform:translateY(-2px)}
    .btn-outline{background:transparent;color:var(--teal);border:1px solid var(--teal)}
    .btn-outline:hover{background:rgba(0,201,177,.08);transform:translateY(-2px)}
    .btn-danger{background:transparent;color:#e05c5c;border:1px solid #e05c5c}
    .btn-danger:hover{background:rgba(224,92,92,.1)}
    .btn-sm{padding:.3rem .8rem;font-size:.65rem}
    .login-box{text-align:center}
    .login-box h2{font-family:'Cinzel Decorative',serif;color:var(--teal);font-size:1.3rem;margin-bottom:1.5rem}
    .login-error{color:#e05c5c;font-size:.85rem;margin-top:.5rem;min-height:1.2em}

    /* Analytics */
    .analytics{margin-bottom:2rem;padding:1.5rem;background:rgba(0,201,177,.04);border:1px solid rgba(0,201,177,.15);border-radius:4px}
    .analytics h3{font-family:'Cinzel Decorative',serif;color:var(--teal);font-size:.95rem;margin-bottom:1.25rem;letter-spacing:.05em}
    .analytics-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:1.25rem}
    .analytics-stat{text-align:center;padding:1rem;background:rgba(5,8,16,.5);border:1px solid var(--border);border-radius:2px}
    .analytics-stat .num{font-family:'Cinzel Decorative',serif;font-size:1.8rem;color:#fff;display:block}
    .analytics-stat .lbl{font-size:.7rem;letter-spacing:.15em;text-transform:uppercase;color:var(--muted)}
    .story-analytics{margin-top:1rem}
    .story-analytics-row{display:grid;grid-template-columns:1fr auto auto auto auto;gap:1rem;align-items:center;padding:.6rem 0;border-bottom:1px solid rgba(58,123,213,.1);font-size:.85rem}
    .story-analytics-row:first-child{font-size:.7rem;letter-spacing:.1em;text-transform:uppercase;color:var(--muted);padding-bottom:.5rem}
    .sa-title{color:var(--text)}
    .sa-num{color:var(--teal);text-align:center;font-family:'Cinzel Decorative',serif}

    /* Comment moderation */
    .mod-comment{display:flex;justify-content:space-between;align-items:flex-start;gap:1rem;padding:.75rem 0;border-bottom:1px solid rgba(58,123,213,.1)}
    .mod-comment-content{flex:1}
    .mod-comment-meta{font-size:.75rem;color:var(--muted);margin-bottom:.25rem}
    .mod-comment-text{font-size:.9rem;font-style:italic;color:var(--text)}

    .admin-story-list{margin-top:1.5rem;border-top:1px solid var(--border);padding-top:1.5rem}
    .admin-story-item{display:flex;justify-content:space-between;align-items:center;padding:.75rem 0;border-bottom:1px solid rgba(58,123,213,.1);gap:1rem}
    .admin-story-item-title{color:var(--text);font-size:.95rem;flex:1}
    .admin-story-item-actions{display:flex;gap:.5rem;flex-shrink:0}
    .admin-tabs{display:flex;gap:.5rem;margin-bottom:2rem;border-bottom:1px solid var(--border);padding-bottom:0}
    .admin-tab{background:none;border:none;border-bottom:2px solid transparent;color:var(--muted);padding:.5rem 1rem .75rem;font-family:'Cinzel Decorative',serif;font-size:.7rem;letter-spacing:.1em;text-transform:uppercase;cursor:pointer;transition:all .2s;margin-bottom:-1px}
    .admin-tab:hover{color:var(--text)}
    .admin-tab.active{color:var(--teal);border-bottom-color:var(--teal)}
    .tab-content{display:none}.tab-content.active{display:block}
    .ad-slot{background:rgba(10,18,40,.6);border:1px dashed rgba(58,123,213,.2);border-radius:4px;padding:1.5rem;text-align:center;color:var(--muted);font-size:.8rem;letter-spacing:.1em;text-transform:uppercase;margin:2rem 0}
    .toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%);background:var(--teal);color:var(--bg);padding:.75rem 2rem;border-radius:2px;font-family:'Cinzel Decorative',serif;font-size:.75rem;letter-spacing:.1em;z-index:500;opacity:0;transition:opacity .3s;pointer-events:none;white-space:nowrap}
    .toast.show{opacity:1}
    footer{position:relative;z-index:1;border-top:1px solid var(--border);padding:2rem 0;text-align:center;color:var(--muted);font-size:.85rem}
    footer .logo-small{font-family:'Cinzel Decorative',serif;color:var(--teal);font-size:1rem;display:block;margin-bottom:.5rem}
    @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    @media(max-width:700px){.nav-links{display:none}.modal,.admin-panel{padding:1.5rem}.analytics-grid{grid-template-columns:repeat(2,1fr)}.story-analytics-row{grid-template-columns:1fr auto auto}}
  </style>
</head>
<body>
<div id="stars"></div>
<nav>
  <div class="wrap">
    <a class="nav-logo" href="index.html">‚ú¶ Starry Ink</a>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="stories.html">Stories</a></li>
    </ul>
  </div>
</nav>
<div class="page-header">
  <div class="wrap">
    <h1>The Stories</h1>
    <p>Original fiction ‚Äî all genres, all worlds, all yours to read.</p>
  </div>
</div>
<div class="wrap">
  <div class="ad-slot">[ Advertisement ‚Äî Replace with Google AdSense code ]</div>
  <div class="filters" id="filters"></div>
  <div class="stories-grid" id="storiesGrid"></div>
  <div class="ad-slot">[ Advertisement ‚Äî Replace with Google AdSense code ]</div>
</div>
<footer>
  <div class="wrap">
    <span class="logo-small">‚ú¶ Starry Ink</span>
    <p>¬© 2025 Starry Ink ¬∑ All stories original & copyright protected.</p>
  </div>
</footer>

<button class="admin-trigger" id="adminTrigger">‚ú¶ Admin</button>
<div class="toast" id="toast"></div>

<!-- Read Story Modal -->
<div class="modal-overlay" id="storyModal">
  <div class="modal">
    <button class="modal-close" id="modalClose">‚úï</button>
    <span class="modal-tag" id="modalTag"></span>
    <div class="modal-title" id="modalTitle"></div>
    <div class="modal-body" id="modalBody"></div>
    <div class="story-actions">
      <button class="like-btn" id="likeBtn" onclick="toggleLike()">‚ô• <span id="likeCount">0</span> Likes</button>
      <span class="view-count" id="viewCount"></span>
    </div>
    <div class="comments-section">
      <div class="comments-title">‚ú¶ Comments</div>
      <div id="commentsList"></div>
      <div class="comment-form">
        <input type="text" id="commenterName" placeholder="Your name (optional)"/>
        <textarea id="commenterText" placeholder="Leave a comment..."></textarea>
        <button class="btn btn-outline" style="align-self:flex-start" onclick="submitComment()">Post Comment</button>
      </div>
    </div>
  </div>
</div>

<!-- Admin Overlay -->
<div class="admin-overlay" id="adminOverlay">
  <div class="admin-panel" id="adminPanelBox">
    <button class="modal-close" id="adminClose">‚úï</button>

    <!-- Login -->
    <div id="loginScreen" class="login-box">
      <h2>Admin Access</h2>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="passwordInput" placeholder="Enter password"/>
        <div class="login-error" id="loginError"></div>
      </div>
      <button class="btn btn-primary" onclick="checkPassword()">Enter</button>
    </div>

    <!-- Admin screen -->
    <div id="adminScreen" style="display:none;">
      <h2>‚ú¶ Starry Ink Admin</h2>
      <div class="admin-tabs">
        <button class="admin-tab active" onclick="switchTab('stories')">Stories</button>
        <button class="admin-tab" onclick="switchTab('analytics')">Analytics</button>
        <button class="admin-tab" onclick="switchTab('comments')">Comments</button>
      </div>

      <!-- Stories Tab -->
      <div class="tab-content active" id="tab-stories">
        <div class="form-group">
          <label>Story Title *</label>
          <input type="text" id="storyTitle" placeholder="Enter title..."/>
        </div>
        <div class="form-group">
          <label>Genre / Tag</label>
          <input type="text" id="storyGenre" placeholder="e.g. Fantasy, Romance, Horror..."/>
        </div>
        <div class="form-group">
          <label>Excerpt (teaser shown on card)</label>
          <input type="text" id="storyExcerpt" placeholder="A short teaser line..."/>
        </div>
        <div class="form-group">
          <label>Full Story *</label>
          <textarea id="storyBody" placeholder="Write or paste your full story here. Separate paragraphs with a blank line."></textarea>
        </div>
        <div class="form-actions">
          <button class="btn btn-primary" id="saveBtn" onclick="saveStory()">‚ú¶ Publish Story</button>
          <button class="btn btn-outline" onclick="clearForm()">Clear</button>
        </div>
        <div class="admin-story-list" id="adminStoryList"></div>
      </div>

      <!-- Analytics Tab -->
      <div class="tab-content" id="tab-analytics">
        <div class="analytics">
          <h3>‚ú¶ Overview</h3>
          <div class="analytics-grid" id="overviewStats"></div>
          <div class="story-analytics">
            <div class="story-analytics-row">
              <span>Story</span><span>Views</span><span>Likes</span><span>Comments</span>
            </div>
            <div id="storyAnalyticsRows"></div>
          </div>
        </div>
      </div>

      <!-- Comments Tab -->
      <div class="tab-content" id="tab-comments">
        <div id="allCommentsList"></div>
      </div>
    </div>
  </div>
</div>

<script>
  const PASS = 'Rose980880@';
  const SK = 'starryink_stories';
  const MK = 'starryink_meta'; // views, likes, comments per story
  let isAdmin = false;
  let editingId = null;
  let activeGenre = 'all';
  let currentStoryId = null;
  let stories = [];
  let meta = {}; // { storyId: { views, likes, likedByMe, comments: [] } }

  // Starfield
  const sc = document.getElementById('stars');
  for(let i=0;i<180;i++){
    const s=document.createElement('div');s.classList.add('star');
    const sz=Math.random()*2.5+.5;
    s.style.cssText=`width:${sz}px;height:${sz}px;top:${Math.random()*100}%;left:${Math.random()*100}%;--lo:${(Math.random()*.3+.05).toFixed(2)};--hi:${(Math.random()*.6+.3).toFixed(2)};--d:${(Math.random()*4+2).toFixed(1)}s;animation-delay:${(Math.random()*5).toFixed(1)}s;`;
    sc.appendChild(s);
  }

  function load(){
    try{stories=JSON.parse(localStorage.getItem(SK)||'[]')}catch{stories=[]}
    try{meta=JSON.parse(localStorage.getItem(MK)||'{}')}catch{meta={}}
  }
  function persist(){
    try{localStorage.setItem(SK,JSON.stringify(stories))}catch{}
    try{localStorage.setItem(MK,JSON.stringify(meta))}catch{}
  }
  function getMeta(id){
    if(!meta[id]) meta[id]={views:0,likes:0,likedByMe:false,comments:[]};
    return meta[id];
  }
  function readTime(t){return Math.max(1,Math.round((t||'').split(/\s+/).length/200))}

  function renderStories(){
    const grid=document.getElementById('storiesGrid');
    const filtersEl=document.getElementById('filters');
    const genres=['all',...new Set(stories.map(s=>s.genre).filter(Boolean))];
    filtersEl.innerHTML=genres.map(g=>`<button class="filter-btn${g===activeGenre?' active':''}" onclick="setGenre('${g}')">${g==='all'?'All':g}</button>`).join('');
    const filtered=activeGenre==='all'?stories:stories.filter(s=>s.genre===activeGenre);
    if(!filtered.length){grid.innerHTML='<div class="empty-state"><span>‚ú¶</span>No stories yet ‚Äî check back soon.</div>';return}
    grid.innerHTML=filtered.map(s=>{
      const m=getMeta(s.id);
      return`<div class="story-card" onclick="openStory('${s.id}')">
        <span class="card-tag">‚ú¶ ${s.genre||'Original Fiction'}</span>
        <div class="card-title">${s.title}</div>
        <p class="card-excerpt">${s.excerpt||''}</p>
        <div class="card-footer">
          <div class="card-stats">
            <span class="card-stat">üëÅ ${m.views}</span>
            <span class="card-stat">‚ô• ${m.likes}</span>
            <span class="card-stat">üí¨ ${m.comments.length}</span>
          </div>
          <span class="read-more">Read ‚Üí</span>
        </div>
      </div>`;
    }).join('');
  }

  function setGenre(g){activeGenre=g;renderStories()}

  function openStory(id){
    const s=stories.find(x=>x.id===id);if(!s)return;
    currentStoryId=id;
    const m=getMeta(id);
    m.views++;persist();
    document.getElementById('modalTag').textContent='‚ú¶ '+(s.genre||'Original Fiction');
    document.getElementById('modalTitle').textContent=s.title;
    document.getElementById('modalBody').innerHTML=s.body.split(/\n\n+/).filter(p=>p.trim()).map(p=>`<p>${p.replace(/\n/g,'<br>')}</p>`).join('');
    renderLike();renderViewCount();renderComments();
    document.getElementById('storyModal').classList.add('open');
    document.body.style.overflow='hidden';
    renderStories();
  }

  function renderLike(){
    const m=getMeta(currentStoryId);
    const btn=document.getElementById('likeBtn');
    btn.classList.toggle('liked',m.likedByMe);
    document.getElementById('likeCount').textContent=m.likes;
  }
  function renderViewCount(){
    const m=getMeta(currentStoryId);
    document.getElementById('viewCount').textContent=`${m.views} view${m.views!==1?'s':''}`;
  }
  function toggleLike(){
    const m=getMeta(currentStoryId);
    if(m.likedByMe){m.likes--;m.likedByMe=false}else{m.likes++;m.likedByMe=true}
    persist();renderLike();renderStories();
  }
  function renderComments(){
    const m=getMeta(currentStoryId);
    const el=document.getElementById('commentsList');
    if(!m.comments.length){el.innerHTML='<div class="no-comments">No comments yet ‚Äî be the first! ‚ú¶</div>';return}
    el.innerHTML=m.comments.map(c=>`
      <div class="comment">
        <div class="comment-name">${c.name||'Anonymous Reader'}</div>
        <div class="comment-text">${c.text}</div>
        <div class="comment-date">${new Date(c.date).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})}</div>
      </div>`).join('');
  }
  function submitComment(){
    const name=document.getElementById('commenterName').value.trim();
    const text=document.getElementById('commenterText').value.trim();
    if(!text){showToast('Write something first!');return}
    const m=getMeta(currentStoryId);
    m.comments.push({name,text,date:new Date().toISOString()});
    persist();
    document.getElementById('commenterName').value='';
    document.getElementById('commenterText').value='';
    renderComments();renderStories();
    showToast('Comment posted! ‚ú¶');
  }

  function closeModal(){document.getElementById('storyModal').classList.remove('open');document.body.style.overflow='';currentStoryId=null}
  document.getElementById('modalClose').onclick=closeModal;
  document.getElementById('storyModal').onclick=e=>{if(e.target.id==='storyModal')closeModal()};

  // Admin
  document.getElementById('adminTrigger').onclick=()=>{document.getElementById('adminOverlay').classList.add('open');document.body.style.overflow='hidden';if(isAdmin)showAdminScreen()};
  document.getElementById('adminClose').onclick=closeAdmin;
  document.getElementById('adminOverlay').onclick=e=>{if(e.target.id==='adminOverlay')closeAdmin()};
  document.getElementById('passwordInput').onkeydown=e=>{if(e.key==='Enter')checkPassword()};

  function closeAdmin(){document.getElementById('adminOverlay').classList.remove('open');document.body.style.overflow='';clearForm()}
  function checkPassword(){
    if(document.getElementById('passwordInput').value===PASS){
      isAdmin=true;document.getElementById('loginError').textContent='';document.getElementById('passwordInput').value='';showAdminScreen();
    }else{document.getElementById('loginError').textContent='Incorrect password.'}
  }
  function showAdminScreen(){
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('adminScreen').style.display='block';
    renderAdminList();renderAnalytics();renderAllComments();
  }

  function switchTab(tab){
    document.querySelectorAll('.admin-tab').forEach((t,i)=>t.classList.toggle('active',['stories','analytics','comments'][i]===tab));
    document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
    document.getElementById('tab-'+tab).classList.add('active');
    if(tab==='analytics')renderAnalytics();
    if(tab==='comments')renderAllComments();
  }

  function renderAnalytics(){
    const totalViews=stories.reduce((a,s)=>a+getMeta(s.id).views,0);
    const totalLikes=stories.reduce((a,s)=>a+getMeta(s.id).likes,0);
    const totalComments=stories.reduce((a,s)=>a+getMeta(s.id).comments.length,0);
    document.getElementById('overviewStats').innerHTML=`
      <div class="analytics-stat"><span class="num">${totalViews}</span><span class="lbl">Total Views</span></div>
      <div class="analytics-stat"><span class="num">${totalLikes}</span><span class="lbl">Total Likes</span></div>
      <div class="analytics-stat"><span class="num">${totalComments}</span><span class="lbl">Comments</span></div>`;
    if(!stories.length){document.getElementById('storyAnalyticsRows').innerHTML='<p style="color:var(--muted);font-style:italic;font-size:.9rem;margin-top:1rem;">No stories yet.</p>';return}
    const sorted=[...stories].sort((a,b)=>getMeta(b.id).views-getMeta(a.id).views);
    document.getElementById('storyAnalyticsRows').innerHTML=sorted.map(s=>{
      const m=getMeta(s.id);
      return`<div class="story-analytics-row">
        <span class="sa-title">${s.title}</span>
        <span class="sa-num">${m.views}</span>
        <span class="sa-num">${m.likes}</span>
        <span class="sa-num">${m.comments.length}</span>
      </div>`;
    }).join('');
  }

  function renderAllComments(){
    const el=document.getElementById('allCommentsList');
    const allComments=[];
    stories.forEach(s=>{
      getMeta(s.id).comments.forEach(c=>allComments.push({...c,storyTitle:s.title,storyId:s.id}));
    });
    allComments.sort((a,b)=>new Date(b.date)-new Date(a.date));
    if(!allComments.length){el.innerHTML='<p style="color:var(--muted);font-style:italic;font-size:.9rem;">No comments yet.</p>';return}
    el.innerHTML=allComments.map((c,i)=>`
      <div class="mod-comment">
        <div class="mod-comment-content">
          <div class="mod-comment-meta">${c.name||'Anonymous'} ¬∑ on "${c.storyTitle}" ¬∑ ${new Date(c.date).toLocaleDateString()}</div>
          <div class="mod-comment-text">${c.text}</div>
        </div>
        <button class="btn btn-danger btn-sm" onclick="deleteComment('${c.storyId}','${c.date}')">Delete</button>
      </div>`).join('');
  }

  function deleteComment(storyId,date){
    const m=getMeta(storyId);
    m.comments=m.comments.filter(c=>c.date!==date);
    persist();renderAllComments();renderAnalytics();renderStories();showToast('Comment deleted.');
  }

  function renderAdminList(){
    const list=document.getElementById('adminStoryList');
    if(!stories.length){list.innerHTML='<p style="color:var(--muted);font-style:italic;font-size:.9rem;margin-top:1rem;">No stories published yet.</p>';return}
    list.innerHTML='<p style="color:var(--muted);font-size:.75rem;letter-spacing:.1em;text-transform:uppercase;margin-bottom:1rem;">Published Stories</p>'+
      stories.map(s=>`
        <div class="admin-story-item">
          <span class="admin-story-item-title">${s.title}</span>
          <div class="admin-story-item-actions">
            <button class="btn btn-outline btn-sm" onclick="editStory('${s.id}')">Edit</button>
            <button class="btn btn-danger btn-sm" onclick="deleteStory('${s.id}')">Delete</button>
          </div>
        </div>`).join('');
  }

  function saveStory(){
    const title=document.getElementById('storyTitle').value.trim();
    const genre=document.getElementById('storyGenre').value.trim();
    const excerpt=document.getElementById('storyExcerpt').value.trim();
    const body=document.getElementById('storyBody').value.trim();
    if(!title||!body){showToast('Title and story are required!');return}
    if(editingId){
      const idx=stories.findIndex(s=>s.id===editingId);
      if(idx!==-1)stories[idx]={...stories[idx],title,genre,excerpt,body};
      editingId=null;document.getElementById('saveBtn').textContent='‚ú¶ Publish Story';
    }else{
      stories.unshift({id:'story_'+Date.now(),title,genre,excerpt,body,date:new Date().toISOString()});
    }
    persist();clearForm();renderAdminList();renderStories();showToast('Story published! ‚ú¶');
  }

  function editStory(id){
    const s=stories.find(x=>x.id===id);if(!s)return;
    editingId=id;
    document.getElementById('storyTitle').value=s.title;
    document.getElementById('storyGenre').value=s.genre||'';
    document.getElementById('storyExcerpt').value=s.excerpt||'';
    document.getElementById('storyBody').value=s.body;
    document.getElementById('saveBtn').textContent='‚ú¶ Update Story';
    document.getElementById('adminPanelBox').scrollTop=0;
    switchTab('stories');
  }

  function deleteStory(id){
    if(!confirm('Delete this story? This cannot be undone.'))return;
    stories=stories.filter(s=>s.id!==id);
    delete meta[id];
    persist();renderAdminList();renderStories();showToast('Story deleted.');
  }

  function clearForm(){
    editingId=null;
    ['storyTitle','storyGenre','storyExcerpt','storyBody'].forEach(id=>document.getElementById(id).value='');
    document.getElementById('saveBtn').textContent='‚ú¶ Publish Story';
  }

  function showToast(msg){
    const t=document.getElementById('toast');
    t.textContent=msg;t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'),2500);
  }

  load();renderStories();
</script>
</body>
</html>
